# Тестирование оплаты и вывода

При желании подписаться на автора, нужно оплатить его подписку. Поэтому под оплатой подразумевается успешное пополнение
баланса автора и приобретение желаемой подписки.

Автор же в свою очередь может вывести деньги на карточку или телефон (QIWI).

## 1. Оплата

В случае нехватки средств/ошибки в номере карты/ошибки в номере телефона ошибка будет на стороне сервиса оплаты.
Уведомление на vdonate приходит только, если выйдет время оплаты или оплата будет успешной.

1. Нажатие на кнопку оплата редиректит на сервис оплаты ✅
2. После перехода по ссылке устанавливается таймер 5 минут ✅
3. После перехода по ссылке пишется краткая информация о транзакции ✅

![](imgs/transaction.png)

4. По истечении 5 минут приходит уведомление о том, что вышел срок оплаты ✅
5. Уведомление о том, что вышел срок оплаты приходит без перезагрузки страницы ✅
6. Оплата по карточке ✅
7. Оплата по номеру QIWI ✅
8. После оплаты автоматический редирект с QIWI на страницу автора ✅
9. Уведомление об успешной оплате ✅
10. Уведомление об успешной оплате приходит без перезагрузки страницы ✅
11. Подписка после успешной оплаты ✅

## 2. Баланс и вывод средств

1. Проверяем транзакцию из секции [оплата](#1-оплата)
2. Уведомление о подписке юзера с именем "name" ✅
3. Баланс в профиле автора пополнился ✅
4. Кнопка "Вывести деньги" ✅
5. Ввод цифр доступен ✅
6. Ввод латинских букв недоступен ✅
7. Ввод кириллицы недоступен ✅
8. Ввод спецсимволов недоступен ✅
9. Ввод номера длины меньше 11 недоступен ✅
10. Ввод номера длины больше 11 недоступен ✅
11. Ввод номера длины 11 доступен ✅
12. Вывод баланса на корректный номер телефона ✅
13. Вывод на номер, который есть в пуле стран (8...) доступен ✅
14. Вывод на номер, которого нет в пуле стран недоступен ✅
15. Вывод на 16-тизначный (некорректный) номер карты недоступен ✅
16. Вывод на несуществующий номер карты ❌

> **[БАГ]**
>
> Ожидание: Ошибка о несуществующем номере карты
>
> Реальность: Ошибка с кодом 500
>
> ![](imgs/wrong-card-number.png)

17. Вывод на корректный номер карты с нехваткой баланса для комиссии (50 рублей + 5%) ❌

> **[БАГ]**
>
> Ожидание: Ошибка о нехватке баланса
>
> Реальность: Ошибка с кодом 500
>
> ![](imgs/no-balance.png)

18. Вывод на корректный номер карты ❌

> **[БАГ]**
>
> Ожидание: Средства выводятся
>
> Реальность: Ошибка с кодом 500
>
> ![](imgs/withdraw-error.png)

# Тестирование смены подписки

Имеем такой кейс:

![](imgs/change-pass.png)

1. При нажатии на кнопку "Задонатить" редиректит на сервис оплаты ✅
2. При [оплате](#1-оплата) прошлая подписка отменяется, а новая применяется ✅
3. Автору приходит уведомление, что пользователь с "name" поменял подписку ❌

> **[БАГ]**
>
> Ожидание: Уведомление о смене подписке пользователя
>
> Реальность: Ничего не приходит

4. Пополнение [баланса](#2-баланс-и-вывод-средств) автора ✅
